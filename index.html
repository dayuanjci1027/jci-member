<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <title>æœƒå“¡é€šè¨ŠéŒ„</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    /* =========================================
       0. å…¨åŸŸè¨­å®š
       ========================================= */
    :root {
      --jci-blue: #0097D7;
      --jci-navy: #003C88;
      --jci-green: #28a745;
      --bg-color: #f3f6f9;
      --text-dark: #1a1a1a;
      --text-gray: #666666;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-color); margin: 0; padding: 0;
      color: var(--text-dark); -webkit-tap-highlight-color: transparent;
    }
    body.noscroll { overflow: hidden; }

    /* è®€å–é®ç½© */
    #loading-mask {
      position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
      background: #fff; z-index: 999999; display: flex; 
      flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.3s;
    }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--jci-blue); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #loading-text { font-size: 14px; color: #666; font-weight: bold; }

    /* =========================================
       1. ç™»å…¥ä»‹é¢
       ========================================= */
    #login-view {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
      background: #fff; z-index: 99999; flex-direction: column; align-items: center; justify-content: flex-start;
      overflow-y: auto;
    }
    .login-banner {
      width: 100%; height: 260px;
      background: linear-gradient(135deg, var(--jci-navy) 0%, var(--jci-blue) 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      color: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
      margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,60,136,0.3);
    }
    .banner-icon { font-size: 50px; margin-bottom: 15px; background: rgba(255,255,255,0.2); width: 90px; height: 90px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .banner-title { font-size: 28px; font-weight: 700; margin-bottom: 6px; }
    .banner-subtitle { font-size: 14px; opacity: 0.9; min-height: 20px; }
    
    .login-form { width: 85%; max-width: 360px; display: flex; flex-direction: column; gap: 16px; }
    .input-label { font-size: 14px; color: var(--jci-navy); font-weight: 600; margin-bottom: 6px; display: block; }
    .login-input { width: 100%; padding: 14px; font-size: 16px; border: 1px solid #e0e6ed; border-radius: 10px; box-sizing: border-box; outline: none; background: #f8faff; }
    .login-input:focus { border-color: var(--jci-blue); background: #fff; }
    .login-btn { margin-top: 10px; width: 100%; padding: 14px; font-size: 18px; font-weight: 600; color: white; background: var(--jci-navy); border: none; border-radius: 10px; cursor: pointer; }
    .error-msg { color: #ff3b3b; font-size: 14px; text-align: center; font-weight: bold; margin-top: 5px; }

    /* =========================================
       2. ä¸»åˆ—è¡¨ä»‹é¢
       ========================================= */
    .page-container { display: none; width: 100%; min-height: 100vh; }
    .header-area {
      background: white; padding: 0 0 16px;
      border-bottom-left-radius: 24px; border-bottom-right-radius: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 16px; position: relative; 
    }
    .top-bar { background: var(--jci-navy); height: 12px; width: 100%; }
    
    .btn-logout {
      position: absolute; top: 20px; left: 15px;
      font-size: 13px; color: #999; cursor: pointer;
      padding: 4px 8px; border: 1px solid #eee; border-radius: 4px;
    }

    .org-name {
      margin-top: 20px; text-align: center; font-size: 26px; font-weight: 800;
      color: var(--jci-navy); letter-spacing: 1px; line-height: 1.2; margin-bottom: 8px;
    }
    .title-row { position: relative; display: flex; justify-content: center; align-items: center; margin-bottom: 8px; padding: 0 20px; }
    .main-title { font-size: 22px; font-weight: 700; color: #333; }
    .version-badge { position: absolute; right: 20px; font-size: 12px; color: white; background: var(--jci-blue); padding: 2px 8px; border-radius: 10px; font-weight: bold; }
    .credit-text { text-align: center; font-size: 12px; color: #888; margin-bottom: 16px; }

    .search-wrapper { padding: 0 20px; max-width: 600px; margin: 0 auto; }
    .search-input { width: 100%; padding: 12px 20px; font-size: 16px; border: 2px solid #e1e5eb; border-radius: 50px; box-sizing: border-box; outline: none; background: #fcfcfc; transition: border-color 0.2s; }
    .search-input:focus { border-color: var(--jci-blue); }

    .sort-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 12px 20px 0; max-width: 600px; margin: 0 auto; }
    .btn-sort {
      background: white; border: 1px solid var(--jci-blue); color: var(--jci-blue);
      padding: 8px 4px; border-radius: 8px; font-size: 14px; font-weight: 500;
      display: flex; align-items: center; justify-content: center; gap: 4px;
      cursor: pointer; transition: all 0.2s; text-align: center; white-space: nowrap; 
    }
    .btn-sort.active { background: var(--jci-blue); color: white; }

    #list-view { padding: 0 16px 60px; max-width: 600px; margin: 0 auto; }

    .member-card {
      background: #fff; border-radius: 16px; padding: 16px; margin-bottom: 14px;
      border-left: 5px solid var(--jci-blue); box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: flex; gap: 16px; position: relative; transition: transform 0.1s;
    }
    .member-card:active { transform: scale(0.98); }
    
    .card-left { flex-shrink: 0; padding-top: 4px; }
    .avatar-img {
      width: 72px; height: 72px; border-radius: 50%; overflow: hidden;
      background: #e1f0ff; display: flex; align-items: center; justify-content: center;
      font-size: 28px; font-weight: bold; color: var(--jci-navy);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .avatar-img img { width: 100%; height: 100%; object-fit: cover; }

    .card-right { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
    .row-1 { display: flex; align-items: baseline; gap: 8px; margin-bottom: 6px; }
    .txt-name { font-size: 22px; font-weight: 800; color: #222; }
    .txt-role { font-size: 14px; color: #666; font-weight: normal; background: #f0f2f5; padding: 2px 6px; border-radius: 4px; }
    .tag-yb { font-size: 13px; color: var(--jci-blue); border: 1px solid #b3e5fc; background: #e1f5fe; padding: 2px 8px; border-radius: 4px; flex-shrink: 0; font-weight: 500; margin-left: auto; }
    .row-2 { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; }
    .badge-honor { background: var(--jci-navy); color: #fff; font-size: 12px; padding: 3px 8px; border-radius: 4px; white-space: nowrap; }
    .txt-company { font-size: 13px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; text-align: right; }
    .row-3 { display: flex; justify-content: flex-end; align-items: center; gap: 10px; padding-top: 8px; border-top: 1px solid #f0f4f8; }
    .txt-phone { font-size: 16px; color: #444; font-weight: 500; letter-spacing: 0.5px; }
    .btn-call { background: var(--jci-blue); color: white; padding: 6px 16px; border-radius: 50px; font-size: 14px; font-weight: 500; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0, 151, 215, 0.3); cursor: pointer; text-decoration: none; }
    .btn-call span { margin-left: 4px; }

    /* =========================================
       3. è©³ç´°é  (Detail View)
       ========================================= */
    #detail-view {
      display: none; position: fixed; inset: 0; z-index: 100; background: #fff;
      max-width: 600px; left: 50%; transform: translateX(-50%);
      box-shadow: 0 0 30px rgba(0,0,0,0.1);
    }
    @media (max-width: 600px) { #detail-view { left: 0; transform: translateX(0); max-width: 100%; } }

    .float-back-btn {
      position: absolute; top: 20px; left: 20px; width: 44px; height: 44px;
      background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center;
      color: white; font-size: 24px; font-weight: bold; text-decoration: none; z-index: 999;
      backdrop-filter: blur(4px); box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .detail-scroll-container { width: 100%; height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch; background: #fff; }
    .hero-image-area {
      width: 100%; height: auto; min-height: 250px; background: linear-gradient(to bottom, #f0f4f8, #fff);
      display: flex; align-items: center; justify-content: center;
      border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; position: relative; z-index: 1;
      padding: 40px 0 20px 0;
    }
    .hero-image { position: static; width: 85%; max-width: 320px; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 4px solid white; }
    .hero-fallback { position: static; width: 85%; max-width: 320px; aspect-ratio: 1 / 1; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 80px; font-weight: bold; color: #fff; background: #ccc; border: 4px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
    .detail-content { padding: 10px 20px 60px; }
    .dt-header { text-align: center; margin-bottom: 20px; }
    .dt-name { font-size: 32px; font-weight: 800; color: var(--jci-navy); margin-bottom: 6px; }
    .dt-role { font-size: 18px; color: var(--text-gray); font-weight: 500; }
    .dt-tags { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
    .tag-pill { padding: 6px 14px; border-radius: 20px; font-size: 14px; font-weight: 500; display: flex; align-items: center; }
    .pill-navy { background: var(--jci-navy); color: white; }
    .pill-blue { background: #e1f5fe; color: var(--jci-blue); border: 1px solid #b3e5fc; }
    .pill-green { background: var(--jci-green); color: white; text-decoration: none; box-shadow: 0 2px 6px rgba(40, 167, 69, 0.3); }
    
    .dt-table { background: #f8faff; border-radius: 16px; padding: 10px 20px; }
    .dt-row { display: flex; align-items: flex-start; padding: 14px 0; border-bottom: 1px solid #eef2f5; font-size: 16px; line-height: 1.6; }
    .dt-row:last-child { border-bottom: none; }
    .dt-label { width: 68px; text-align: justify; text-align-last: justify; color: #888; font-weight: 500; flex-shrink: 0; margin-right: 20px; }
    .dt-val { flex: 1; color: #333; font-weight: 500; word-break: break-all; }
  </style>
</head>
<body>

  <div id="loading-mask">
    <div class="spinner"></div>
    <div id="loading-text">è³‡æ–™è¼‰å…¥ä¸­...</div>
  </div>

  <div id="login-view">
    <div class="login-banner">
      <div class="banner-icon">ğŸ”’</div>
      <div class="banner-title">æœƒå“¡é€šè¨ŠéŒ„</div>
      <div class="banner-subtitle">è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿèˆ‡å‡ºç”Ÿå¹´æœˆæ—¥</div>
    </div>
    <div class="login-form">
      <label class="input-label">èº«åˆ†è­‰å­—è™Ÿ (å¸³è™Ÿ)</label>
      <input type="text" id="login-acc" class="login-input" placeholder="ä¾‹å¦‚ï¼šA123456789" oninput="this.value = this.value.toUpperCase()" style="text-transform:uppercase;">
      <label class="input-label">è¥¿å…ƒå‡ºç”Ÿå¹´æœˆæ—¥ (å¯†ç¢¼)</label>
      <input type="password" id="login-pwd" class="login-input" placeholder="è¥¿å…ƒ8ç¢¼ ä¾‹å¦‚ï¼š19900101">
      <div id="login-error" class="error-msg"></div>
      <button class="login-btn" onclick="attemptLogin()">ç™»å…¥æŸ¥è©¢</button>
    </div>
  </div>

  <div class="page-container">
    <div class="header-area">
      <div class="top-bar"></div>
      <div class="btn-logout" onclick="doLogout()">ç™»å‡º</div>
      <div class="org-name">å¤§åœ’åœ‹éš›é’å¹´å•†æœƒ</div>
      <div class="title-row">
        <div class="main-title">æœƒå“¡é€šè¨ŠéŒ„</div>
        <div class="version-badge">GitHub V5.0</div>
      </div>
      <div class="credit-text">GitHub æ¥µé€Ÿæ¶æ§‹ç‰ˆ</div>

      <div class="search-wrapper">
        <input id="search" class="search-input" type="text" onkeyup="filterList()" placeholder="æœå°‹ å§“å / å…¬å¸ / é›»è©±">
      </div>

      <div class="sort-wrapper">
        <div id="btn-council" class="btn-sort" onclick="toggleCouncil()">æœƒå‹™äººå“¡<span></span></div>
        <div id="btn-pres" class="btn-sort" onclick="togglePres()">æ­·å±†å‰æœƒé•·<span></span></div>
        <div id="btn-chair" class="btn-sort" onclick="toggleChair()">æ­·å±†å‰ä¸»å¸­<span></span></div>
        <div id="btn-date" class="btn-sort" onclick="toggleDate()">å…¥æœƒæ—¥æ’åº<span></span></div>
      </div>
    </div>

    <div id="list-view"></div>

    <div id="detail-view">
      <a href="javascript:void(0)" class="float-back-btn" onclick="backToList()">â†</a>
      <div class="detail-scroll-container">
        <div class="hero-image-area">
          <img id="hero-img" class="hero-image" alt="photo">
          <div id="hero-fallback" class="hero-fallback"></div>
        </div>
        <div class="detail-content">
          <div class="dt-header">
            <div id="dt-name" class="dt-name"></div>
            <div id="dt-role" class="dt-role"></div>
          </div>
          <div class="dt-tags">
            <div id="tag-badge" class="tag-pill pill-navy"></div>
            <div id="tag-yb" class="tag-pill pill-blue"></div>
            <a id="tag-call" href="#" class="tag-pill pill-green" target="_parent">ğŸ“<span>æ’¥æ‰“</span></a>
          </div>
          <div id="dt-table" class="dt-table"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==========================================
    // â˜… è¨­å®šå€
    // ==========================================
    const MY_LIFF_ID = "2008793289-PIQx5rgr";
    
    // â˜…â˜…â˜… å‹™å¿…ä¿®æ”¹ç‚ºå‰›å‰›éƒ¨ç½²çš„ GAS ç¶²å€ â˜…â˜…â˜…
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbxFY3E-bA1WzWMNOixDXbXyOJ0flebfs-6nyPokYWsKXXKYWYhcXuMeQAXoRRUSHsNB/exec"; 

    // å…¨åŸŸè®Šæ•¸
    let membersData = [];
    let labelsData = {};
    let activeMode = 'ALL';
    let sortOrder = 0;

    // ==========================================
    // â˜… ç³»çµ±å•Ÿå‹•
    // ==========================================
    window.onload = async function() {
      try {
        // åŒæ­¥åŸ·è¡Œ LIFF åˆå§‹åŒ– & ä¸‹è¼‰è³‡æ–™
        const [liffResult, apiResult] = await Promise.all([
          initLiff(),
          fetchMembers()
        ]);

        // è³‡æ–™è™•ç†
        if(apiResult.status === 'success') {
           membersData = apiResult.members;
           labelsData = apiResult.labels;
        } else {
           alert("è³‡æ–™è¼‰å…¥å¤±æ•—: " + apiResult.message);
        }

        // èº«åˆ†é©—è­‰
        if (liffResult && liff.isLoggedIn()) {
           updateLoading("æ­£åœ¨é©—è­‰èº«åˆ†...");
           const profile = await liff.getProfile();
           checkLineBinding(profile.userId);
        } else {
           // æ²’ç™»å…¥ LIFF (æˆ–é LINE ç’°å¢ƒ)ï¼Œæª¢æŸ¥æœ¬åœ°ç´€éŒ„
           checkLocalStorage();
        }

      } catch (e) {
        alert("ç³»çµ±å•Ÿå‹•éŒ¯èª¤ï¼š" + e);
        showLoginView(); // éŒ¯èª¤å°±ç§€ç™»å…¥é è®“ä½¿ç”¨è€…è©¦è©¦
      }
    };

    function initLiff() {
      return new Promise(resolve => {
         liff.init({ liffId: MY_LIFF_ID })
           .then(() => resolve(true))
           .catch(err => {
             console.log("LIFF Init Error:", err);
             resolve(false); // å¤±æ•—ä¹Ÿå›å‚³ false è®“ç¨‹å¼ç¹¼çºŒ
           });
      });
    }

    function fetchMembers() {
      updateLoading("ä¸‹è¼‰æœ€æ–°çš„æœƒå“¡è³‡æ–™...");
      return fetch(GAS_API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'getMembers' })
      }).then(res => res.json());
    }

    // ==========================================
    // â˜… é©—è­‰èˆ‡ç™»å…¥é‚è¼¯
    // ==========================================
    function checkLineBinding(userId) {
      fetch(GAS_API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'checkLineBinding', payload: { userId: userId } })
      })
      .then(res => res.json())
      .then(res => {
         if(res.status === 'success') {
            updateLoading("é©—è­‰æˆåŠŸï¼Œç™»å…¥ä¸­...");
            document.getElementById('login-acc').value = res.acc;
            document.getElementById('login-pwd').value = res.pwd;
            attemptLogin(true);
         } else {
            // é©—è­‰å¤±æ•— (å¯èƒ½æ˜¯æ²’ç¶å®š)ï¼Œåˆ‡å›ç™»å…¥é 
            checkLocalStorage(); 
         }
      })
      .catch(() => checkLocalStorage());
    }

    function checkLocalStorage() {
      const savedAcc = localStorage.getItem('jci_acc');
      const savedPwd = localStorage.getItem('jci_pwd');
      if (savedAcc && savedPwd) {
        document.getElementById('login-acc').value = savedAcc;
        document.getElementById('login-pwd').value = savedPwd;
        attemptLogin(true);
      } else {
        showLoginView();
      }
    }

    function attemptLogin(isAuto) {
      const acc = document.getElementById('login-acc').value.trim().toUpperCase();
      const pwd = document.getElementById('login-pwd').value.trim();
      const errDiv = document.getElementById('login-error');

      if (!acc || !pwd) {
        if(!isAuto) errDiv.textContent = "è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼";
        return;
      }

      const user = membersData.find(m => m.acc === acc && m.pwd === pwd);

      if (user) {
        if (user.role && user.role.includes('å‰æœƒå“¡')) {
           if(!isAuto) errDiv.textContent = "å‰æœƒå“¡ç„¡æ³•ç™»å…¥";
           return;
        }

        // ç™»å…¥æˆåŠŸ
        localStorage.setItem('jci_acc', acc);
        localStorage.setItem('jci_pwd', pwd);

        if (!isAuto) {
          fetch(GAS_API_URL, { 
             method: 'POST', 
             body: JSON.stringify({ action: 'recordLoginLog', payload: { name: user.name, account: acc } }) 
          });
        }
        
        showMainList();
        renderList(membersData);

      } else {
        if(isAuto) {
           showLoginView(); // è‡ªå‹•ç™»å…¥å¤±æ•—æ‰é¡¯ç¤ºç™»å…¥é 
        } else {
           errDiv.textContent = "å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤";
           document.getElementById('login-pwd').value = "";
        }
      }
    }

    function doLogout() {
      if(confirm('ç¢ºå®šè¦ç™»å‡ºä¸¦æ¸…é™¤ç´€éŒ„å—ï¼Ÿ')) {
        localStorage.removeItem('jci_acc');
        localStorage.removeItem('jci_pwd');
        
        if (typeof liff !== 'undefined' && liff.isLoggedIn()) {
           liff.logout();
        }
        
        // é‡æ–°æ•´ç†é é¢ï¼Œå› ç‚º localStorage ç©ºäº†ï¼Œæœƒè‡ªå‹•åœåœ¨ç™»å…¥é 
        location.reload(); 
      }
    }

    // ==========================================
    // â˜… ä»‹é¢åˆ‡æ›èˆ‡æ¸²æŸ“
    // ==========================================
    function updateLoading(text) { document.getElementById('loading-text').textContent = text; }
    
    function showLoginView() {
      document.getElementById('loading-mask').style.opacity = '0';
      setTimeout(() => {
         document.getElementById('loading-mask').style.display = 'none';
         document.getElementById('login-view').style.display = 'flex';
      }, 300);
    }

    function showMainList() {
      document.getElementById('loading-mask').style.display = 'none';
      document.getElementById('login-view').style.display = 'none';
      document.querySelector('.page-container').style.display = 'block';
    }

    function renderList(data) {
      const container = document.getElementById("list-view");
      if (data.length === 0) {
        container.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">æ²’æœ‰ç¬¦åˆçš„è³‡æ–™</div>';
        return;
      }
      let html = "";
      data.forEach(m => {
        const originalIndex = membersData.indexOf(m);
        const digits = (m.phone || "").replace(/[^0-9]/g, "");
        
        // åœ–ç‰‡è™•ç†
        const imgHtml = m.photoUrl 
          ? `<img src="${m.photoUrl}" onerror="this.style.display='none'; this.parentNode.innerText='${m.initial}';">`
          : m.initial;

        html += `
          <div class="member-card" onclick="openDetail(${originalIndex})">
            <div class="card-left">
              <div class="avatar-img">${imgHtml}</div>
            </div>
            <div class="card-right">
              <div class="row-1">
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span class="txt-name">${m.name}</span>
                  ${m.role ? `<span class="txt-role">${m.role}</span>` : ''}
                </div>
                ${m.tag ? `<div class="tag-yb">${m.tag}</div>` : ''}
              </div>
              ${ (m.badge || m.company) ? `
              <div class="row-2">
                <div class="badge-honor" style="${m.badge?'':'display:none'}">${m.badge}</div>
                <div class="txt-company">${m.company}</div>
              </div>` : '' }
              <div class="row-3">
                <div class="txt-phone">${m.phone}</div>
                ${digits ? `<a class="btn-call" href="tel:${digits}" target="_parent" onclick="event.stopPropagation()">ğŸ“<span>æ’¥æ‰“</span></a>` : ''}
              </div>
            </div>
          </div>`;
      });
      container.innerHTML = html;
    }

    // ==========================================
    // â˜… è©³ç´°é é‚è¼¯ (å«æ»‘å‹•è¿”å›)
    // ==========================================
    const detailCols = ["C","F","G","H","I","J","K","L","M","N"];
    const colKeyMap = {"C":"colC","F":"colF","G":"colG","H":"colH","I":"colI","J":"colJ","K":"colK","L":"colL","M":"colM","N":"colN"};

    function openDetail(idx) {
      const m = membersData[idx];
      if(!m) return;
      
      const dv = document.getElementById("detail-view");
      dv.style.display = "block";
      dv.style.transform = (window.innerWidth <= 600) ? "translateX(0px)" : "translateX(-50%)";
      document.body.classList.add('noscroll');

      // å¡«å…¥è³‡æ–™
      document.getElementById("dt-name").textContent = m.name;
      document.getElementById("dt-role").textContent = m.role;
      
      const img = document.getElementById("hero-img");
      const fb = document.getElementById("hero-fallback");
      if (m.photoUrl) {
         img.src = m.photoUrl; img.style.display = "block"; fb.style.display = "none";
      } else {
         img.style.display = "none"; fb.textContent = m.initial; fb.style.display = "flex";
      }
      img.onerror = function(){ img.style.display = "none"; fb.textContent = m.initial; fb.style.display = "flex"; };

      document.getElementById("tag-badge").textContent = m.badge;
      document.getElementById("tag-badge").style.display = m.badge ? "flex" : "none";
      
      document.getElementById("tag-yb").textContent = m.tag;
      document.getElementById("tag-yb").style.display = m.tag ? "flex" : "none";

      const digits = (m.colC || m.phone || "").replace(/[^0-9]/g, "");
      const callBtn = document.getElementById("tag-call");
      if(digits) { callBtn.href = "tel:" + digits; callBtn.style.display = "flex"; } else { callBtn.style.display = "none"; }

      const fields = document.getElementById("dt-table");
      fields.innerHTML = "";
      detailCols.forEach(col => {
         const key = colKeyMap[col];
         if(m[key]) {
            fields.innerHTML += `
              <div class="dt-row">
                <div class="dt-label">${labelsData[col]||col}</div>
                <div class="dt-val">${m[key]}</div>
              </div>`;
         }
      });
    }

    function backToList() {
      document.getElementById("detail-view").style.display = "none";
      document.body.classList.remove('noscroll');
    }

    // æ»‘å‹•è¿”å›é‚è¼¯
    let swipeStartX = 0;
    let isSwiping = false;
    document.addEventListener("touchstart", e => {
       if(document.getElementById("detail-view").style.display === "block" && window.innerWidth <= 600 && e.touches[0].clientX < 60) {
          swipeStartX = e.touches[0].clientX; isSwiping = true;
          document.getElementById("detail-view").style.transition = "none";
       }
    }, {passive:true});

    document.addEventListener("touchmove", e => {
       if(!isSwiping) return;
       const d = e.touches[0].clientX - swipeStartX;
       if(d > 0) document.getElementById("detail-view").style.transform = `translateX(${d}px)`;
    }, {passive:true});

    document.addEventListener("touchend", e => {
       if(!isSwiping) return;
       isSwiping = false;
       const d = (e.changedTouches[0].clientX) - swipeStartX;
       const dv = document.getElementById("detail-view");
       dv.style.transition = "transform 0.25s ease-out";
       if (d > window.innerWidth * 0.4) {
          dv.style.transform = `translateX(${window.innerWidth}px)`;
          setTimeout(backToList, 250);
       } else {
          dv.style.transform = "translateX(0px)";
       }
    }, {passive:true});

    // ==========================================
    // â˜… æ’åºèˆ‡ç¯©é¸
    // ==========================================
    function filterList() { filterAndSort(); }

    function toggleCouncil() { setMode('COUNCIL', 'btn-council'); }
    function togglePres()    { setMode('PRES', 'btn-pres'); }
    function toggleChair()   { setMode('CHAIR', 'btn-chair'); }
    function toggleDate()    { setMode('DATE', 'btn-date'); }

    function setMode(mode, btnId) {
      document.querySelectorAll('.btn-sort').forEach(b => {
         b.classList.remove('active');
         b.querySelector('span').textContent = '';
      });
      
      const btn = document.getElementById(btnId);
      const span = btn.querySelector('span');

      if (mode === 'COUNCIL') {
         if (activeMode === 'COUNCIL') sortOrder = 0; else sortOrder = 1;
      } else {
         if (activeMode === mode) { sortOrder = (sortOrder+1)%3; } else { sortOrder = 1; }
      }

      if (sortOrder === 0) {
         activeMode = 'ALL';
         span.textContent = "";
      } else {
         activeMode = mode;
         btn.classList.add('active');
         if(mode !== 'COUNCIL') span.textContent = (sortOrder === 1) ? 'â†‘' : 'â†“';
      }
      filterAndSort();
    }

    function filterAndSort() {
      const q = document.getElementById("search").value.trim().toLowerCase();
      let filtered = membersData.filter(m => (m.name+m.badge+m.role+m.company+m.phone).toLowerCase().includes(q));

      if (activeMode === 'COUNCIL') {
         const keywords = ['æœƒé•·', 'å‰¯æœƒé•·', 'å¸¸å‹™ç†äº‹', 'å¸¸å‹™ç›£äº‹', 'ç†äº‹', 'ç›£äº‹', 'ç§˜æ›¸é•·', 'è²¡å‹™é•·', 'æ³•åˆ¶é¡§å•', 'ç¸½å¹¹äº‹', 'OBä¸»å¸­', 'OBå‰¯ä¸»å¸­', 'OBç¸½å¹¹äº‹', 'ä¸»å§”'];
         filtered = filtered.filter(m => {
            if(!m.role) return false;
            return keywords.some(k => m.role.includes(k) && (k.startsWith('OB') || !m.role.includes('å‰'+k)));
         });
      } else if (activeMode === 'PRES') {
         filtered = filtered.filter(m => m.badge && m.badge.includes('æœƒé•·'));
      } else if (activeMode === 'CHAIR') {
         filtered = filtered.filter(m => m.badge && m.badge.includes('ä¸»å¸­'));
      }

      if (sortOrder !== 0) {
         filtered.sort((a, b) => {
            let valA, valB;
            if (activeMode === 'DATE') {
               valA = a.colM || ""; valB = b.colM || "";
               if (!valA && !valB) return 0; if(!valA) return 1; if(!valB) return -1;
               return (sortOrder === 1) ? valA.localeCompare(valB) : valB.localeCompare(valA);
            } else if (activeMode === 'PRES' || activeMode === 'CHAIR') {
               const getNum = s => { const m = (s||"").match(/(\d+)/); return m ? parseInt(m[0],10) : 0; };
               return (sortOrder === 1) ? getNum(a.badge)-getNum(b.badge) : getNum(b.badge)-getNum(a.badge);
            }
            return 0;
         });
      }
      renderList(filtered);
    }
  </script>
</body>
</html>